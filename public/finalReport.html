<!DOCTYPE html>
<!-- final report page for editing -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/finalReport.css">
    <script src="js/inputDigest.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src=" https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/finalReportScript.js"></script>
</head>
<!-- retrieves data from session storage -->
<body onload="retrieveDataReport()">
<nav class="navbar navbar-expand-lg navbar-inverse navbar-fixed-top topbar">
    <div class="container-fluid">
        <img src="css/snakes.jpg" style="width: 5%; height: 5%" class="img-circle" alt="logo">
        <a class="title">Final Report</a>

    </div>
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navHeaderCollapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navHeaderCollapse">
            <ul class="nav navbar-nav">
                <li class="nav-item"><a href="home.html">Home</a></li>
                <li class="nav-item"><a href="history.html">History</a></li>
                <li class="nav-item"><a href="help.html">Help</a></li>
            </ul>
        </div>
    </div>
</nav>
<!-- navbar end -->
<div class="container-fluid">

    <!-- panel with Code team -->
    <div class="row row-one">
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <div class="panel panel-default" id="panel4">
                <div class="panel-heading">Code Team</div>
                <div class="panel-body" id="label">Team Leader: <p id="teamLeader"></p></div>
                <div class="panel-body" id="label">Nurse Preparing Meds: <p id="nursePrep"></p></div>
                <div class="panel-body" id="label">Nurse Administering Meds: <p id="nurseAdmin"></p></div>
                <div class="panel-body" id="label">Recorder Nurse: <p id="nurseRecord"></p></div>
                <div class="panel-body" id="label">Anesthesiologist: <p id="anesthesiologist"></p></div>
                <div class="panel-body" id="label">Others: <p id="others1"></p>
                    <p id="others2"></p>
                    <p id="others3"></p>
                    <p id="others4"></p></div>
                <div class = "panel-footer">
                    <button type="button" data-toggle="modal" data-target="#editModal" class="btn btn-primary edit-button"data-panel="4">Edit</button></div>
            </div>
            
        <!-- Pnael containing general information -->
        </div>
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <div class="panel panel-default" id="panel2">
                <div class="panel-heading">General</div>
                <div class="panel-body">Date: <p id="reportDate"></p></div>
                <div class="panel-body">Time: <p id="reportTime"></p></div>
                <div class="panel-body">Location: <p id="reportLoc"></p></div>
                <div class="panel-body">Time event called: <p id="reportTimeEvent"></p></div>
                <div class="panel-body">Time team arrived: <p id="reportTeamArrived"></p></div>
                <div class="panel-body">Witnesses: <p id="reportWitnesses"></p></div>
                <div class="panel-body">CPR Initiated: <p id="reportCPR"></p></div>
                <div class="panel-body">Time of compression: <p id="reportComp"></p></div>
                <div class="panel-footer">
                    <button type="button" data-toggle="modal" data-target="#editModal"
                            class="btn btn-primary edit-button" data-panel="2">Edit
                    </button>
                </div>
            </div>

        </div>
        
        <!-- contains patient Information -->
        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <div class="panel panel-default" id="panel3">
                <div class="panel-heading">Patient Information</div>
                <div class="panel-body">Name: <p id="patientNameReport"></p></div>
                <div class="panel-body">Date of Birth: <p id="patientDOBReport"></p></div>
                <div class="panel-body">MR#: <p id="patientMRReport"></p></div>
                <div class="panel-body">Weight: <p id="patientWeightReport"></p></div>
                <div class="panel-body">Comments: <p id="patientComments"></p></div>

                <div class="panel-footer">
                    <button type="button" data-toggle="modal" data-target="#editModal"
                            class="btn btn-primary edit-button" data-panel="3">Edit
                    </button>
                </div>
            </div>

        </div>
    </div>

    <div class="row row-two">
        
    </div>
</div>

<!-- report table, populated from Flow sheet -->
<div class="row row-three">
    <div class="col-sm-12">
        <div class="panel panel-default" id="panel7">
            <div class="panel-heading">Report Table</div>
            <div class="panel-body">
                <div class="table-wrapper-scroll-y">
                    <table class="table table-bordered table-striped">
                        <thead>
                        <tr>
                            <th scope="col">Time</th>
                            <th scope="col">Intervention</th>
                            <th scope="col">Dose</th>
                            <th scope="col">Rhythm</th>
                            <th scope="col">Jules</th>
                            <th scope="col">Comments</th>
                        </tr>
                        </thead>
                        <tbody contenteditable="true" id="info-table-body">
                        <!--empty table body to be set later -->
                        </tbody>
                    </table>
                </div>

            </div>
            <!-- add row to create a new event or note if needed -->
            <div class="panel-footer">
                <button type="button" class="btn btn-warning add-row-btn" data-panel="7" onclick="addRow()">Add Row +
                </button>
            </div>

        </div>
    </div>
</div>

<div class="row row-four">
    <div class="col-sm-6">
        <!-- big panel for notes -->
        <div class="panel panel-default" id="panel8">
            <div class="panel-heading">Comments:</div>
            <div class="panel-body"><p id="reportFullComments"></p></div>
            <div class="panel-footer">
                <button type="button" data-toggle="modal" data-target="#editModal" class="btn btn-primary edit-button"
                        data-panel="8">Edit
                </button>
            </div>
        </div>
    </div>

    <div class="col-sm-6">
        <!-- big out come panel with results of code -->
      <div class="panel panel-default" id="panel9">
          <div class="panel-heading">Outcome:</div>
          <div class="panel-body" id="label">Patient Outcome: <p id="patientOutcome"> </p></div>
          <div class="panel-body" id="label">Transferred to: <p id="transferredTo"> </p></div>
          <div class="panel-body" id="resuscitationLabel">Reason Resuscitation Ended: </div>
          <div class="panel-body" id="label">Return of Circulation: <p id="circulation"> </p></div>
          <div class="panel-body" id="label">Restrictions by Family: <p id="restrictions"> </p></div>
          <div class="panel-body" id="label">Medical Futility: <p id="futility"> </p></div>
          <div class="panel-body" id="label">Advanced Directives: <p id="advanced"> </p></div>
          <div class="panel-body" id="label">Family Notified: <p id="family"> </p></div>
          <div class="panel-footer">
              <button type="button" data-toggle="modal" data-target="#editModal" class="btn btn-primary edit-button"
                      data-panel="9">Edit
              </button>
            </div>
        </div>
    </div>
</div>

<!-- prints the page or allows to save as pdf -->
<div class="row row-five">
    <button onclick="printPage()" type="button" class="btn btn-warning print-button" style = "margin-left: 48%">Export</button>
    </button>
</div>

<!-- script to export -->
<script>
    function printPage() {
        window.print();
    }
</script>

<!-- edit Modal pops up when any edit button is clicked -->
<div class="modal" id="editModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Title</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- empty Modal body to be filled in from panel -->
            
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Save</button>

            </div>

        </div>
    </div>
</div>

<!-- main script for page -->
<script type="text/javascript">
    //variables
    var panelNumber;
    
    //this function takes which button it clciked,
    //matches it with a panel, and populates the modal from there
    $('#editModal').on('show.bs.modal', function (event) {
        //getting correct panel
        var button = $(event.relatedTarget) // Button that triggered the modal
        var panelNum = button.data('panel')
        panelNumber = panelNum;
        var panel = document.getElementById("panel" + panelNum);
        var panElem = panel.children;
        var modal = $(this);
        
        //get Modal elements
        var modalTitle = modal.find('.modal-title')
        var modalFoot = modal.find('.modal-footer');
        var modalContent = modal.find(".modal-content")
        var modalBody = document.createElement('div');
        modalBody.className = "modal-body modal-body-edit";
        modalContent.append(modalBody);

        modalFoot.insertAfter('.modal-body-edit');

        //POPULATING MODAL
        //set heading
        modal.find('.modal-title').text(panElem[0].innerHTML);

//set body
        if (panelNumber != 8) {
            var i;
            for (i = 1; i < (panElem.length - 1); i++) {
                //create a div
                var newdiv = document.createElement("div");
                
                //takes element from panel splits it to create a label and input box
                var text = panElem[i].innerHTML;
                var textsplit = text.split(":");
                
                //creates label and input box, puts value of input box from panel
                var label = document.createElement("label");
                label.addClass = "label"
                label.innerHTML = textsplit[0];
                var textbox = document.createElement("input");
                textbox.addClass = "input"
                var textForBox = panElem[i].children;
                console.log(textForBox[0].innerHTML);
                textbox.value = textForBox[0].innerHTML;
                //console.log(textsplit[1]);
                
                //appends the label and input to into modal
                var span1 = document.createElement('span')
                span1.appendChild(label);
                span1.appendChild(textbox);
                newdiv.append(span1)
                modal.find('.modal-body').append(newdiv);
            }
            ;
        } else { //happens for comment block
            var textArea = document.createElement("textarea");
            var textElement = panElem[1].children;
            var text = textElement[0].innerHTML;
            textArea.innerHTML = text;
            textArea.addClass = "input";

            modal.find('.modal-body').append(textArea);
        }
    });
    
    //deletes everything from panel when it is closed
    //and populates back to Panel
    $('#editModal').on('hide.bs.modal', function (event) {
        //finding elements
        var modal = $(this);
        var divs = modal.find(".modal-body").children();

        var panel = document.getElementById("panel" + panelNumber);
        var panelElems = panel.children;
        console.log(panelElems);

        //if it isnt the comment panel it goes through each elements and populates
        if (panelNumber != 8) { //if it is not the comment panel
            var j;
            for (j = 0; j < divs.length; j++) {
                var span = divs[j].children;
                var insideSpan = span[0].children;
                var labeltext = insideSpan[0].innerHTML;
                var inputtext = insideSpan[1].value;

                var newparaph = document.createElement("p");
                newparaph.innerHTML = inputtext;
                console.log(labeltext + ":" + inputtext);
                panelElems[j + 1].innerHTML = labeltext + ":";
                panelElems[j + 1].appendChild(newparaph);
            }
        } else { //if it is the comment panel
            var textArea = divs[0].value;
            console.log(textArea);
            console.log(panelElems[1].innerHTML);
            panelElems[1].innerHTML = textArea;
        }
        
        //delete the whole modal body
        modal.find(".modal-body").remove();

    });
    
    //add an empty row the table
    function addRow() {
        var tableBody = document.getElementById("info-table-body");
        console.log(tableBody)
        var newRow = document.createElement("tr");
        var i;
        for (i = 0; i < 6; i++) {
            var newCell = document.createElement("td");
            newRow.appendChild(newCell);
        }
        tableBody.appendChild(newRow);
    }
</script>


</body>
</html>
